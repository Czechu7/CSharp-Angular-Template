<div class="card">
  <div class="flex justify-content-between align-items-center mb-4">
    <!-- TODO: zrobić tłumaczenia -->
    <h2>Lista Karmelków</h2>
    <app-button label="Dodaj nowy" icon="pi pi-plus" (onClick)="showDialog()"></app-button>
  </div>
  <!-- TODO: zrobić reużywalną tabelkę -->
  <p-table [value]="karmelki" [paginator]="true" [rows]="10" [responsive]="true"
    styleClass="p-datatable-gridlines p-datatable-sm" [totalRecords]="totalRecords" [loading]="loading" [lazy]="true"
    (onPage)="loadKarmelki($event)">
    <ng-template pTemplate="header">
      <tr>
        <th>Nazwa</th>
        <th>Ilość</th>
        <th>Cena</th>
        <th>Ziemniak</th>
        <th>Data przybycia</th>
        <th>Akcje</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-karmelek>
      <tr>
        <td>{{ karmelek.name }}</td>
        <td>{{ karmelek.count }}</td>
        <td>{{ karmelek.price | currency:'PLN':'symbol':'1.2-2' }}</td>
        <td>
          <p-tag [severity]="karmelek.isZiemniak ? 'success' : 'danger'" [value]="karmelek.isZiemniak ? 'Tak' : 'Nie'">
          </p-tag>
        </td>
        <td>{{ karmelek.arrivalDate | date:'dd/MM/yyyy' }}</td>
        <td>
          <div class="flex gap-2">
            <app-button icon="pi pi-pencil" severity="info" (onClick)="editKarmelek(karmelek)"></app-button>
            <app-button icon="pi pi-trash" severity="danger" (onClick)="confirmDelete(karmelek)"></app-button>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6" class="text-center p-4">Brak karmelków do wyświetlenia</td>
      </tr>
    </ng-template>
  </p-table>
</div>
<!-- TODO: poprawić wygląd i działanie modala -->
<app-reusable-modal [visible]="dialogVisible" [header]="editMode ? 'Edytuj karmelek' : 'Dodaj nowy karmelek'"
  [style]="{width: '450px'}" [draggable]="false">
  <form [formGroup]="exampleForm" (ngSubmit)="saveKarmelek()">
    <div class="grid">
      <div class="col-12 mb-3">
        <app-input [formControl]="controls.name" label="Nazwa" [errorMessage]="getErrorMessage(controls.name)"
          [invalid]="controls.name.invalid && (controls.name.dirty || controls.name.touched)"
          placeholder="Wpisz nazwę karmelka" autocomplete="name">
        </app-input>
      </div>

      <div class="col-6 mb-3">
        <app-input [formControl]="controls.count" label="Ilość" type="number"
          [errorMessage]="getErrorMessage(controls.count)"
          [invalid]="controls.count.invalid && (controls.count.dirty || controls.count.touched)"
          placeholder="Wpisz ilość" autocomplete="off">
        </app-input>
      </div>

      <div class="col-6 mb-3">
        <app-input [formControl]="controls.price" label="Cena" type="number"
          [errorMessage]="getErrorMessage(controls.price)"
          [invalid]="controls.price.invalid && (controls.price.dirty || controls.price.touched)"
          placeholder="Wpisz cenę" suffixText="PLN" autocomplete="off">
        </app-input>
      </div>

      <div class="col-12 mb-3">
        <div class="field-checkbox">
          <app-checkbox [formControl]="controls.isZiemniak" binary="true" label="Czy to ziemniak?"
            [errorMessage]="getErrorMessage(controls.isZiemniak)"
            [invalid]="controls.isZiemniak.invalid && (controls.isZiemniak.dirty || controls.isZiemniak.touched)">
          </app-checkbox>
        </div>
      </div>
      <!-- TODO: zrobić reużywalny komponent kalendarza -->
      <div class="col-12 mb-3">
        <span class="p-float-label">
          <p-calendar [formControl]="controls.arrivalDate" dateFormat="dd/mm/yy" [showIcon]="true"
            inputId="arrivalDate"></p-calendar>
          <label for="arrivalDate">Data przybycia</label>
        </span>
        <small *ngIf="controls.arrivalDate.invalid && (controls.arrivalDate.dirty || controls.arrivalDate.touched)"
          class="p-error">{{ getErrorMessage(controls.arrivalDate) }}</small>
      </div>
    </div>

    <div class="flex justify-content-end gap-2 mt-4">
      <app-button label="Anuluj" severity="secondary" (onClick)="hideDialog()"></app-button>
      <app-button label="Zapisz" type="submit" [disabled]="exampleForm.invalid"></app-button>
    </div>
  </form>
</app-reusable-modal>

<app-confirm-modal [visible]="confirmDialogVisible" header="Potwierdzenie usunięcia"
  message="Czy na pewno chcesz usunąć ten karmelek?" yesLabel="Tak" noLabel="Nie" (yes)="deleteKarmelek()"
  (no)="confirmDialogVisible = false">
</app-confirm-modal>
